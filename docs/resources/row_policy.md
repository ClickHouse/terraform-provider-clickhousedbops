---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "clickhousedbops_row_policy Resource - clickhousedbops"
subcategory: ""
description: |-
  Manages a ClickHouse row policy, which restricts the rows a user or role can access when querying a table.
  ~> Important: When a row policy is created on a table, all users and roles without a matching policy will see zero rows from that table. You must create an additional permissive policy (e.g. USING 1 to ALL EXCEPT ...) for any users or roles that should retain full access.
  Example Usage
  
  resource "clickhousedbops_user" "user_a" {
    name                 = "user-a"
    password_sha256_hash = var.user_a_password_hash
  }
  
  resource "clickhousedbops_grant_privilege" "user_a_select" {
    privilege_name    = "SELECT"
    database_name     = "logs"
    table_name        = "example_table"
    grantee_user_name = clickhousedbops_user.user_a.name
  }
  
  resource "clickhousedbops_row_policy" "user_a_policy" {
    name              = "user_a_policy"
    database_name     = "logs"
    table_name        = "example_table"
    select_filter     = "user_id = 'a'"
    grantee_user_name = clickhousedbops_user.user_a.name
  }
  
  # Permissive policy for admin users to retain full access
  resource "clickhousedbops_row_policy" "admin_full_access" {
    name              = "admin_full_access"
    database_name     = "logs"
    table_name        = "example_table"
    select_filter     = "1"
    grantee_role_name = "admin"
  }
---

# clickhousedbops_row_policy (Resource)

Manages a ClickHouse row policy, which restricts the rows a user or role can access when querying a table.

~> **Important:** When a row policy is created on a table, **all** users and roles without a matching policy will see zero rows from that table. You must create an additional permissive policy (e.g. `USING 1` to `ALL EXCEPT ...`) for any users or roles that should retain full access.

## Example Usage

```hcl
resource "clickhousedbops_user" "user_a" {
  name                 = "user-a"
  password_sha256_hash = var.user_a_password_hash
}

resource "clickhousedbops_grant_privilege" "user_a_select" {
  privilege_name    = "SELECT"
  database_name     = "logs"
  table_name        = "example_table"
  grantee_user_name = clickhousedbops_user.user_a.name
}

resource "clickhousedbops_row_policy" "user_a_policy" {
  name              = "user_a_policy"
  database_name     = "logs"
  table_name        = "example_table"
  select_filter     = "user_id = 'a'"
  grantee_user_name = clickhousedbops_user.user_a.name
}

# Permissive policy for admin users to retain full access
resource "clickhousedbops_row_policy" "admin_full_access" {
  name              = "admin_full_access"
  database_name     = "logs"
  table_name        = "example_table"
  select_filter     = "1"
  grantee_role_name = "admin"
}
```



<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `database_name` (String) The database of the table to apply the row policy to.
- `name` (String) The name of the row policy.
- `select_filter` (String) The filter expression used in the USING clause. For example: `tenant_id = 'abc'`.
- `table_name` (String) The table to apply the row policy to.

### Optional

- `cluster_name` (String) Name of the cluster to create the resource into. If omitted, resource will be created on the replica hit by the query.
This field must be left null when using a ClickHouse Cloud cluster.
- `for_operations` (List of String) List of operations the row policy applies to (e.g. 'SELECT'). If not specified, defaults to SELECT. Currently only SELECT is supported; this field is designed to support INSERT, UPDATE, DELETE in future ClickHouse versions.
- `grantee_all` (Boolean) Apply the row policy to all users and roles.
- `grantee_all_except` (List of String) Apply the row policy to all users and roles except those listed.
- `grantee_role_names` (List of String) List of role names to apply the row policy to.
- `grantee_user_names` (List of String) List of user names to apply the row policy to.
- `is_restrictive` (Boolean) If true, the policy is restrictive (AND logic). If false (default), the policy is permissive (OR logic).
