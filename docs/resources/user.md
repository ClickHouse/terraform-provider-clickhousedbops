---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "clickhousedbops_user Resource - clickhousedbops"
subcategory: ""
description: |-
  You can use the clickhousedbops_user resource to create a user in a ClickHouse instance.
  Password Field Options
  This resource supports two mutually exclusive password fields designed for different Terraform/OpenTofu environments:
  Modern Approach (Recommended)
  password_sha256_hash_wo: Write-only field for Terraform 1.11+Enhanced Security: Password hash never stored in state fileBetter Privacy: No password data persisted or transmitted in state operationsVersion Requirement: Requires Terraform 1.11.0 or later
  Legacy Compatibility
  password_sha256_hash: Sensitive field for Terraform <1.11 and OpenTofuState Storage: Password hash stored encrypted in state fileCompatibility: Works with all Terraform and OpenTofu versionsUse Case: Required for Terraform <1.11 or when using OpenTofu
  Decision Criteria
  Choose your password field based on:
  | Environment | Recommended Field | Reason |
  |-------------|------------------|---------|
  | Terraform 1.11+ | `password_sha256_hash_wo` | Enhanced security, no state storage |
  | Terraform <1.11 | `password_sha256_hash` | Write-only fields not supported |
  | OpenTofu (any version) | `password_sha256_hash` | Write-only fields not supported |
  | Security-critical environments | `password_sha256_hash_wo` | Password never persisted |
  | Mixed tool environments | `password_sha256_hash` | Universal compatibility |
  Important: You must specify exactly one of these fields. Specifying both will cause validation failure.
  Known limitations:
  Password changes require version bump: Changing password fields alone has no effect. You must increment password_sha256_hash_wo_version.User recreation on password change: Password updates cause the database user to be deleted and recreated.Import limitations: Imported users lack password_sha256_hash_wo_version, requiring recreation on first apply.Version field applies to both: The password_sha256_hash_wo_version field controls both password field types.
---

# clickhousedbops_user (Resource)

You can use the `clickhousedbops_user` resource to create a user in a `ClickHouse` instance.

## Password Field Options

This resource supports two mutually exclusive password fields designed for different Terraform/OpenTofu environments:

### Modern Approach (Recommended)
- **`password_sha256_hash_wo`**: Write-only field for Terraform 1.11+
- **Enhanced Security**: Password hash never stored in state file
- **Better Privacy**: No password data persisted or transmitted in state operations
- **Version Requirement**: Requires Terraform 1.11.0 or later

### Legacy Compatibility 
- **`password_sha256_hash`**: Sensitive field for Terraform <1.11 and OpenTofu
- **State Storage**: Password hash stored encrypted in state file
- **Compatibility**: Works with all Terraform and OpenTofu versions
- **Use Case**: Required for Terraform <1.11 or when using OpenTofu

## Decision Criteria

Choose your password field based on:

| Environment | Recommended Field | Reason |
|-------------|------------------|---------|
| Terraform 1.11+ | `password_sha256_hash_wo` | Enhanced security, no state storage |
| Terraform <1.11 | `password_sha256_hash` | Write-only fields not supported |
| OpenTofu (any version) | `password_sha256_hash` | Write-only fields not supported |
| Security-critical environments | `password_sha256_hash_wo` | Password never persisted |
| Mixed tool environments | `password_sha256_hash` | Universal compatibility |

**Important**: You must specify exactly one of these fields. Specifying both will cause validation failure.

## Known limitations:

- **Password changes require version bump**: Changing password fields alone has no effect. You must increment `password_sha256_hash_wo_version`.
- **User recreation on password change**: Password updates cause the database user to be deleted and recreated.
- **Import limitations**: Imported users lack `password_sha256_hash_wo_version`, requiring recreation on first apply.
- **Version field applies to both**: The `password_sha256_hash_wo_version` field controls both password field types.

## Example Usage

```terraform
# Basic user creation example with modern write-only password field (Terraform 1.11+)
resource "clickhousedbops_user" "john" {
  cluster_name = "cluster"
  name         = "john"
  
  # Modern approach: Write-only password field (recommended for Terraform 1.11+)
  # Password hash is never stored in Terraform state for enhanced security
  password_sha256_hash_wo         = sha256("secure_password_123")
  password_sha256_hash_wo_version = 1
}

# Alternative: Legacy compatibility example for Terraform <1.11 and OpenTofu
# Uncomment this resource and comment the one above if using older Terraform or OpenTofu
/*
resource "clickhousedbops_user" "john_legacy" {
  cluster_name = "cluster"
  name         = "john"
  
  # Legacy approach: Sensitive field stored encrypted in state
  # Use this for Terraform <1.11 or OpenTofu compatibility
  password_sha256_hash            = sha256("secure_password_123")
  password_sha256_hash_wo_version = 1
}
*/

# Best practice: Use variables for password management
variable "user_password" {
  description = "Password for ClickHouse user"
  type        = string
  sensitive   = true
  # Set via environment variable: TF_VAR_user_password or terraform.tfvars
}

resource "clickhousedbops_user" "variable_example" {
  cluster_name = "cluster"
  name         = "variable_user"
  
  # Use variable instead of hardcoding password
  password_sha256_hash_wo         = sha256(var.user_password)
  password_sha256_hash_wo_version = 1
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `name` (String) Name of the user
- `password_sha256_hash_wo_version` (Number) Version of the password_sha256_hash_wo field. Bump this value to require a force update of the password on the user.

### Optional

> **NOTE**: [Write-only arguments](https://developer.hashicorp.com/terraform/language/resources/ephemeral#write-only-arguments) are supported in Terraform 1.11 and later.

- `cluster_name` (String) Name of the cluster to create the resource into. If omitted, resource will be created on the replica hit by the query.
This field must be left null when using a ClickHouse Cloud cluster.
When using a self hosted ClickHouse instance, this field should only be set when there is more than one replica and you are not using 'replicated' storage for user_directory.
- `password_sha256_hash` (String, Sensitive) SHA256 hash of the password to be set for the user (legacy compatibility, stored encrypted in state)
- `password_sha256_hash_wo` (String, [Write-only](https://developer.hashicorp.com/terraform/language/resources/ephemeral#write-only-arguments)) SHA256 hash of the password to be set for the user (Terraform 1.11+ only, not stored in state)

### Read-Only

- `id` (String) The system-assigned ID for the user

## Import

Import is supported using the following syntax:

```shell
# Users can be imported by specifying the ID.
# Find the ID of the user by checking system.users table.
# WARNING: imported users will be recreated during first 'terraform apply' because the password cannot be imported.
terraform import clickhousedbops_user.example xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx

# It's also possible to import users using the username:

terraform import clickhousedbops_user.example username

# IMPORTANT: if you have a multi node cluster, you need to specify the cluster name!

terraform import clickhousedbops_user.example cluster:xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
terraform import clickhousedbops_user.example cluster:username
```
